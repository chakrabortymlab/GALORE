# Genome Assembly

Once your sequencing reads have been filtered for quality and length, the next step is to **assemble them into a draft genome**. Genome assembly is the process of stitching together overlapping sequencing reads to reconstruct the original genome. When we assemble a genome from scratch, without the aid of another reference genome, it is referred to as a *de novo* genome assembly. For Oxford Nanopore reads, which are long but can be error-prone, assemblers designed specifically for long reads (such as [Hifiasm](https://www.nature.com/articles/s41592-020-01056-5) or [Flye](https://www.nature.com/articles/s41587-019-0072-8)) are ideal.

In this project, we use **Flye**, a fast and accurate assembler optimized for PacBio Hifi and ONT long-read data.

## Prerequisites
- Ensure you have your filtered sequencing data and the required tools installed (see course software list).
- You'll need to have downloaded the D. melanogaster ISO1 reference genome from FlyBase.


## Step 1. Run the Assembly
```bash
flye --nano-hq -o flye_BLXXXX -g 140M SRRXXX_filt.fastq
```
- `--nano-hq`: specifies that the reads are Oxford Nanopore R10 (high-quality) reads
- `-o`: specifies a name for the output directory
- `-g`: the approximate genome size of the species. *D. melanogaster* has a euchromatic genome size of about 140 Mb
- Input: the filtered FASTQ file

## Output
When the assembly is completed, the output will be located in a directory with the name specified by -o, containing:
- Assembled sequences, or contigs, in FASTA format (`assembly.fasta`)
- Assembly graph files (.gfa, .gv)
- Log files (.log)

## Step 2. View assembly FASTA
The **contigs** in your assembly.fasta file represent your preliminary draft genome â€” continuous sequences assembled from overlapping reads. Take a peek at your draft assembly file using `less`.

Example:
```text
>contig_1
GCTCCAGCACTCATAATAGACAGACAACAACTACCTAAAACTGCTAATGGTCTCCTCTGA
TGCAGATCCATCATCAGTATGTACTCCCACATGCAGAGCACACACACACACACACACACA
CACACACACACACACACACACACACACACACACACACACATATATATATTCCATAACTAA
...
```

Note that the sequences are given arbitrary names like 'contig_1'. That's because the genome assembler doesn't know which sequence belongs to a certain chromosome, or even which sequences are next to each other on a chromosome.

## Step 3. Rename assembly FASTA
By default, Flye names the finished assembly FASTA 'assembly.fasta'. It's good practice to give files descriptive names, especially when you are performing the same steps on multiple data sets. Rename your assembly to include strain name, sequencing type (ONT), and assembler (Flye).

For example, to rename an assembly for BL2969:
```bash
mv assembly.fasta BL2969_ont_flye.fasta
```

---

## Step 4. Scaffold the Assembly with RagTag
Once you have a set of contigs from your assembler, you can attempt to **order and orient them into scaffolds** using a reference genome. Scaffolding does not change the sequence of the contigs themselves but places them in context, making the draft assembly more chromosome-like.

We will use **RagTag**, a reference-guided scaffolding tool.

```bash
ragtag.py scaffold dmel_reference.fasta BL2969_ont_flye.fasta -o ragtag_BL2969
```
- `scaffold`: tells RagTag to run the scaffolding module
- `dmel-all-chromosome-r6.63.fasta`: the reference genome FASTA (ex. ISO1 reference)
- `BL2969_ont_flye.fasta`: your assembled contigs from Flye
- `-o`: output directory

## Output
RagTag will produce:
- `ragtag.scaffold.fasta`: the scaffolded assembly
- AGP and BED files describing the placements of contigs
- Log files detailing alignments and decisions made during scaffolding

You can rename the scaffolded file for clarity:
```bash
mv ragtag_BL2969/ragtag.scaffold.fasta BL2969_ont_flye_scaffolded.fasta
```

---

## TO DO: Assemble and Scaffold all Strains
1. Modify the example code to assemble the genomes of your strains with Flye.
2. Scaffold each assembly with RagTag using the appropriate reference genome.
3. Rename the outputs consistently for downstream analysis.
